<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>The Weather</title>
    <link rel="stylesheet" href="assets/style/style.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>
<body>
    <!-- the header or the title -->
    <header>
        <h1>Weather Dashbroad</h1>
    </header>
    <div class="container">
        <div class="row">
            <!-- this is the searching part of the page -->
            <div class="col-md-3" id="searching">
                <h3>Search for a city:</h3>
                <input type="text" id="theCityInput">
                <button id="searchBtn">search</button>
                <div id="theCityDisplay"></div>
            </div>
            <!-- this is the place to display the information -->
            <div class="col-md-9" id="info">
                <!-- this is the city and todays weather -->
                <div class="row" id="todayinfo">
                    <div class="col-md-12" id="todaydisplay">
                        <h3><span id="cityname">city</span> <span id="todaydate"></span><img id="todayIcon" src="" alt="picture of sky in this weather"></h3> 
                        <p>Temperature: <span id="temp"></span></p>
                        <p>Humidity: <span id="humidity"></span></p>
                        <p>Wind Speed: <span id="wind"></span></p>
                        <p>UV Index: <span id="UV"></span></p>
                    </div>
                </div>
                <!-- this is the forecast display -->
                <div class="row" id="forecastweather">
                    <div class="col-md-12" id="forecastdisplay">
                        <h2>5-Day Forecast:</h2>

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
<script src="assets/javascript/script.js"></script>
<script>
var theCityNameArray = [];
$("#searchBtn").on("click", function(){
    var theCityName = $("#theCityInput").val();
    theAjaxCall(theCityName);
});

function addCity(cityName){
    $("#theCityDisplay").empty();
    theCityNameArray.indexOf(cityName.toLowerCase()) === -1 ? theCityNameArray.push(cityName) : console.log("This city already exists");
    // theCityNameArray.push(cityName);
    localStorage.setItem("theCityNameArray", theCityNameArray);
    for(i=0; i < theCityNameArray.length; i++){
        var newDiv = $("<div>");
        newDiv.text(theCityNameArray[i]);
        newDiv.addClass("cityNameTag");
        $("#theCityDisplay").append(newDiv);
    }
}
function theAjaxCall(cityName){
    var city = cityName.replace( " ", "%20");
    var theWeatherUrl = "http://api.openweathermap.org/data/2.5/weather?q=" + city + "&appid=2c9429a7f45eac540b72e1c276819bfd";
    $.ajax({
        url: theWeatherUrl,
        method: "GET"
    }).then(function(response) {
        changeTodayInformation(response);
        addCity(cityName);
        // forecastFiveDays(cityName);
    }).fail(function(){
        alert("not a city name");
    });

    
}
function changeTodayInformation(response){
    var degreeKelvin = response.main.temp;
    var degreeF = degreeKelvin * (9/5) - 459.67;
    $("#cityname").text(response.name);
    $("#todayIcon").attr("src","http://openweathermap.org/img/w/" + response.weather[0].icon + ".png");
    $("#todayIcon").css("visibility", "visible");
    $("#todaydate").text(moment().format('L'));
    $("#temp").text(degreeF.toFixed(1) + "F");
    $("#humidity").text(response.main.humidity);
    $("#wind").text(response.wind.speed);
    var lat = response.coord.lat;
    var lon = response.coord.lon;
    var UVIndexURL = "http://api.openweathermap.org/data/2.5/uvi?appid=2c9429a7f45eac540b72e1c276819bfd&lat=" + lat + "&lon=" + lon;
    $.ajax({
        url : UVIndexURL,
        method: "GET"
    }).then(function(response){
        $("#UV").text(response.value);
    });
    
    // have to be paid accounts only omg
    // var forecastFiveDayURL = "api.openweathermap.org/data/2.5/forecast/daily?lat=" + lat + "&lon=" + lon + "&cnt=5&appid=2c9429a7f45eac540b72e1c276819bfd";
    // $.ajax({
    //     url : forecastFiveDayURL,
    //     method : "GET"
    // }).then(function(response){
    //     console.log(response);
    // });
}
</script>
</html>